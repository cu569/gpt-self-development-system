const puppeteer = require('puppeteer');
const path = require('path');

(async () => {
  // 1) Chrome 열기 (headless: false 로 사람처럼)
  const browser = await puppeteer.launch({
    headless: false,
    defaultViewport: null,
    args: ['--start-maximized']
  });
  const page = await browser.newPage();

  // 2) YouTube Studio 접속 (로그인済이어야 합니다)
  await page.goto('https://studio.youtube.com', { waitUntil: 'networkidle2' });

  // 3) 페이지 로드 후, '동영상 만들기' 버튼 클릭
  await page.waitForSelector('ytcp-button[aria-label="동영상 만들기"]', { visible: true });
  await page.click('ytcp-button[aria-label="동영상 만들기"]');

  // 4) '동영상 업로드' 메뉴 클릭
  await page.waitForSelector('tp-yt-paper-item[role="option"]', { visible: true });
  const items = await page.$$('tp-yt-paper-item[role="option"]');
  for (let item of items) {
    const text = await item.evaluate(el => el.innerText);
    if (text.includes('동영상 업로드')) {
      await item.click();
      break;
    }
  }

  // 5) 파일 다이얼로그 대기 & 사용자 선택
  const [fileChooser] = await Promise.all([
    page.waitForFileChooser(),
    // Puppeteer가 자동으로 파일 다이얼로그를 띄움
    page.click('input#upload-prompt-file-input')  
  ]);

  // 6) 여기서 직접 파일을 선택하세요!
  //    (예: macOS 파일 선택창에서 업로드할 .mp4 를 고르고 '열기' 클릭)
  await fileChooser.accept(); 

  // 7) 제목·설명 입력
  await page.waitForSelector('#textbox', { visible: true });
  const textboxes = await page.$$('#textbox');
  // 첫 번째는 제목
  await textboxes[0].click({ clickCount: 3 });
  await textboxes[0].type('자동화 테스트 영상 제목');
  // 두 번째는 설명
  await textboxes[1].click();
  await textboxes[1].type('이 설명은 Puppeteer로 자동 입력되었습니다.');

  // 8) 예약 시간 설정 (공개 설정 단계까지 넘어간 후)
  await page.click('ytcp-button#next-button'); // 다음
  await page.click('ytcp-button#next-button'); // 다음
  await page.click('ytcp-button#next-button'); // 다음
  // 공개 설정: 예약
  await page.click('tp-yt-paper-radio-button[name="PRIVATE"]'); // 필요시 변경
  // 예약 시간 입력 (예: 내일 오전 10시)
  await page.click('input#datepicker-trigger'); // 달력 열기
  // (달력 UI 조작 코드 삽입 가능 – 생략)
  await page.click('ytcp-button#done-button'); // 완료

  // 9) 최종 확인
  console.log('✅ 업로드 프로세스가 완료되었습니다.');
  // browser.close(); // 자동 종료하고 싶다면 주석 해제
})();
